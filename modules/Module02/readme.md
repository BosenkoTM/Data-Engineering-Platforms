# Модуль 2: Базы данных и SQL

[Обратно в содержание курса :leftwards_arrow_with_hook:](https://github.com/BosenkoTM/Data-Engineering-Platforms/blob/master/readme.md)

Познакомимся с базами данных, и поймем их преимущество для работы с данными по сравнению с Excel/Google Sheets.

Потренируемся на SQL, установим базу данных и загрузим в нее данные, потом будем использовать Excel/Google Sheets для визуализации данных.

## 2.1 Введение

После первого модуля мы разобрались, что такое аналитика, как она работает, как она помогает бизнесу быть успешнее и какие важные навыки необходимы для специалистов, которые работают с данными.

Несмотря на то, что курс называется «Введение в инжиниринг данных» мы затронули разные области и инструменты. В последующих модулях мы будем непосредственно изучать, как эти инструменты работают и всё, что мы будем делать будет пересекаться с первым модулем.

Например, когда мы будем использовать базу данных, мы будем думать о том, как база данных может помочь эффективнее принимать бизнес-решения.

Второй модуль посвящен базам данных и SQL. БД являются основополагающими для любой аналитики. БД используются во всех организациях, чтоб собирать данных в структурированные формы.

Дальше мы будем учиться загружать и извлекать данные в БД, использовать язык SQL.


## 2.2: Что такое базы данных и как они помогают при работе с данными

Самый главный навык для людей, которые занимаются аналитикой - это разобраться с SQL и базами данных. Я считаю, что большинство компаний на российском и иностранном рынке используют базы данных для того, чтобы хранить данные, подключать их к бизнес приложениям, делать аналитические решения, делать Machine learning/Data Science.

В интернете очень много информации про базы данных, которую сложно понять и применить на практике, что является одной из проблем индустрии. Я считаю, что если вы поняли базовую концепцию на простом языке, то дальше у вас есть все необходимые инструменты для того, чтобы найти и понять этот термин более детально.

Прежде всего базы данных - это программа для хранения данных. Такая же программа, как операционная система, которую мы устанавливаем на компьютеры, на сервер и её основная задача — это хранение данных.

Базы данных делятся на два типа: SQL (реляционные) и NoSQL (нереляционные).
Мы будем говорить про реляционные базы данных.
Я покажу один из примеров использования нереляционных баз данных, чтобы вам стало понятно для чего они используются. Как правило, инженер данных напрямую не работает с нереляционными базами данных. Для нас центр вселенной — это хранилище данных или платформа данных, куда мы «складываем» все данные, которые потом доступны для анализа. При этом «забирать» данные мы можем и из NoSQL баз данных.

Пример использования нереляционных баз данных - сайт компании Abebooks, которая занимается продажей б/у книг. Весь инвентарь этого сайта, который включает в себя порядка 350 млн уникальных наименований хранится в NoSQL базе данных. Ранее данные хранились в реляционной базе данных от Oracle и были проблемы с производительностью, так как очень сложно и дорого масштабировать реляционную базу данных. Компания приняла решение мигрировать на NoSQL, где DynamoDB выступает в роли backend базы данных для веб-сайтов, в которой находится весь инвентарь компании и за счёт этого появились возможности увеличить количество инвентаря и технические проблемы больше не сдерживают рост компании. Моя задача как инженера данных эти данные «забирать».

Вернемся к реляционным базам данных.
Бочонок – самый распространённый термин, который используется во всех диаграммах для обозначения БД; когда мы с вами рисовали архитектуру аналитического решения, я использовал этот бочонок.
Мы работали с Excel после первого модуля и уже знаем, что в Excel данные находятся в табличном представлении. Примерно такие же таблицы хранятся в базах данных.
На картинке вы видите таблицы, их можно группировать в схемы. Схема внутри базы данных – это логическое пространство, где мы можем группировать наши таблицы. Например, мы часто используем схемы, чтобы разделить области внутри хранилища данных (в архитектуре аналитического решения на область Staging и Business layer). Область Staging для сырых данных, область Business для таблиц с показателями, которую мы подключаем к BI-инструментам.

Из чего состоит таблица в БД? Точно также, как в Excel, таблица состоит из столбцов (columns) и строк (rows), у каждой колонки есть заголовки. На картинке вы видим, что схема называется stg, таблица – cities, в которой есть три колонки. Примерно в таком формате данные отображаются в БД.

Языки SQL.
Есть четыре типа языков: языки для создания запросов (DML+DQL) и языки для управления БД (DDL+DCL). Как инженер данных вы можете писать обычные запросы, изменять таблицы, вставлять данные, также вы можете создавать таблицы и схемы, раздавать права.
Совершенно не важно, какую базу данных вы используете, все они имеют схожие принципы.

Пример использования реляционной базы данных. Допустим у нас есть интернет-магазин, который продает футболки, после добавления выбранной футболки в корзину, я перехожу на страницу оплаты заказа, после оплаты заказа транзакция считается успешно завершенной. Строчка, в которой есть моё имя, информация обо мне, информация о продукте, который я купил, его стоимость и других атрибутов – называется транзакция. Эта транзакция отправляется в базу данных, она вставляется в таблицу или разные таблицы одной или несколькими строчками (в зависимости от дизайна). Смысл базы данных в фиксации информации, в данном случае она фиксирует факт продажи. Если я как аналитик хочу посмотреть, сколько у нас было заказов, мне необходимо написать SQL-запрос к этой таблице.

В практической части мы скачаем и установим PostgreSQL, в следующей главе мы будем к нему подключаться и рассмотрим, какие способы подключения существуют.

**часть 1 - теория** - [Что такое база данных]().

**часть 2 - практика** [Установка Postgres]().

### Дополнительные материалы для изучения

1. [Введение в Базы Данных](https://stepik.org/course/551/) (Русский)
2. [Хранилище данных vs Озеро Данных](https://habr.com/ru/post/485180/) (Русский)

### Лабораторная работа 2.1

1. Установить Postgres базу данных на компьютер. [Инструкции по установки Postgres](https://github.com/BosenkoTM/Data-Engineering-Platforms/blob/master/how-to/How%20to%20install%20PostgreSQL.md).

## 2.3: Подключение к Базам Данных и SQL

**Видео лекция часть 1 - теория** - [Подключение к БД](https://youtu.be/nJsRJ5SytjI).

**Видео лекция часть 2 - практика** - [Подключение к БД, загрузка данных в БД, SQL запросы ](https://youtu.be/nJsRJ5SytjI?t=657)

### Дополнительные материалы для изучения

1. [Интерактивный онлайн-курс по SQL СУБД PostgreSQL](https://learndb.ru/) (Русский)
2. [Интерактивный SQL учебник с упражнениями](https://sql-ex.ru/) (Русский)
3. [Основные функции SQL](https://khashtamov.com/ru/window-functions-sql/) (Русский)
4. [Практика SQL](https://towardsdatascience.com/sqlzoo-the-best-way-to-practice-sql-66b7ccb1f17a) (English)
5. [SQL: Analyzing Business Metrics](https://www.codecademy.com/learn/sql-analyzing-business-metrics) (English)
6. [Analyze data with SQL](https://www.codecademy.com/learn/paths/analyze-data-with-sql) (English)
7. [Большой курс SQL и Баз Данных от Stanford](https://www.edx.org/course/databases-5-sql) (English)
8. [Интерактивный тренажер по SQL](https://stepik.org/course/63054/) (Русский)
9. [Лучшие вопросы средней сложности по SQL на собеседовании аналитика данных](https://habr.com/ru/company/dcmiran/blog/500360/) (Русский)

### Лабораторная работа 2.2

1. Установить клиент SQL для подключения базы данных. [Инструкции по установки DBeaver](https://github.com/BosenkoTM/Data-Engineering-Platforms/blob/master/how-to/How%20to%20install%20DBeaver.md). Так же вы можете использовать любой другой клиент для подключения к ваше БД.
2. Создать 3 таблицы и загрузите данные из [Superstore Excel файл](https://github.com/BosenkoTM/Data-Engineering-Platforms/blob/master/modules/Module01/Lab%201.1/Sample%20-%20Superstore.xls) в базу данных. Сохраните в  GitHub скрипт загрузки данных и создания таблиц. Вы можете использовать готовый [пример sql файлов](https://github.com/BosenkoTM/Data-Engineering-Platforms/tree/master/modules/Module02).
3. Напишите запросы, чтобы ответить на вопросы из [Модуля 01](https://github.com/BosenkoTM/Data-Engineering-Platforms/blob/master/modules/Module01/Lab%201.1/readme.md#%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0-%D0%B2-excel). Сохраните в вашем GitHub скрипт загрузки данных и создания таблиц.

## 2.4: Модели Данных

**Видео лекция часть 1 - теория** - [Модели Данных](https://youtu.be/Jwefn9G2I_g)

**Видео лекция часть 2 - практика** - [Создание модели данных в SQLdbm](https://youtu.be/Jwefn9G2I_g?t=1903)

### Дополнительные материалы для изучения

1. Статья про Хранилище Данных [Антихрупкость архитектуры хранилищ данных](https://habr.com/ru/post/281553/)
2. Статья про Data Vault [Основы Data Vault](https://habr.com/ru/post/502968/)

### Лабораторная работа 2.3

1. Нарисовать модель данных для  файла [Superstore](https://github.com/Data-Learn/data-engineering/blob/master/DE-101%20Modules/Module01/DE%20-%20101%20Lab%201.1/Sample%20-%20Superstore.xls):
   
- Концептуальную.
- Логическую.
- Физическую.
  Вы можете использовать бесплатную версию [SqlDBM](https://sqldbm.com/Home/) или любой другой софт для создания моделей данных баз данных.

2. Скопировать  `DDL` и выполнить его в `SQL`-клиенте.
3. Необходимо сделать `INSERT INTO SQL`, чтобы заполнить **Dimensions** таблицы и **Sales Fact** таблицу. Сначала  заполняем **Dimensions** таблицы, где в качестве **id** генерим последовательность чисел, а затем **Sales Fact** таблицу, в которую вставляем **id** из **Dimensions** таблиц.

## 2.5: База данных в облаке

**Видео лекция часть 1 - теория** - [БД в облаке](https://youtu.be/UzILBlOAQ9s)

**Видео лекция часть 2 - практика** - [Создание Аналитической БД в облаке AWS](https://youtu.be/UzILBlOAQ9s?t=627)

### Дополнительные материалы для изучения

Мы посвятим целый модуль облачным вычислениям. Но к сожалению, очень мало информации по сетевому администрированию, которую легко и быстро усвоить. Цель простая - нам необходимо, чтобы 2 и более сервера могли эффективно и безопасно коммуницировать между собой через сеть. Для этого нужно открыть/закрыть порты, настроить firewall и возможны другие действия. Вы можете поискать информацию.

1. Лекции на Coursera [Google IT Support Professional](https://www.coursera.org/professional-certificates/google-it-support) (English)
2. [Шпаргалка системного администратора по сетевым инструментам Linux](https://habr.com/ru/company/ruvds/blog/417485/) (Русский)

### Лабораторная работа 2.4

1. Опционально(при наличии доступа к облачному сервису). Необходимо [создать учетную запись в AWS](https://github.com/Data-Learn/data-engineering/blob/master/how-to/How%20to%20create%20AWS%20Account.md). Это бесплатно. Если вы запускаете сервис в AWS, не забудьте его удалить, когда он не нужен.
2. Опционально(при наличии доступа к облачному сервису). Используя сервис AWS Lightsail или [AWS RDS (смотрите инструкцию)](https://github.com/Data-Learn/data-engineering/blob/master/how-to/how_to_amazon_rds.md) создайте БД Postgres и активируйте **Public access**
3. Подключитесь к новой БД через SQL клиент (например DBeaver).
4. Загрузите данные из пункта 2.3 (Superstore dataset) в staging (схема БД `stg`) и загрузите dimensional model (схема `dw`). Вы можете использовать  пример SQL для этого упражнения:

- Staging [stg.orders.sql](https://github.com/BosenkoTM/Data-Engineering-Platforms/blob/master/modules/Module02/Lab%202.1/stg.orders.sql)
- Business Layer [from_stg_to_dw.sql](https://github.com/BosenkoTM/Data-Engineering-Platforms/blob/master/modules/Module02/Lab%202.1/from_stg_to_dw.sql)

5. Выполнить свои запросы из предыдущих упражнений. Не забудьте указать схему перед название таблицы. Например, `public.orders` или `stg.orders`.

## 2.6: Как донести данные до бизнес-пользователя (Пример решений на KlipFolio, Google Sheets и пр.)

**Видео лекция часть 1 - теория** - [Сервисы визуализации для базы данных](https://youtu.be/bqUtv1y3D7A)

**Видео лекция часть 2 - практика** - [Пример подключения к облачным сервисам](https://youtu.be/bqUtv1y3D7A?t=825)

### Дополнительные материалы для изучения

Данная лекция знакомит вас с популярными сервисами для визуализации данных. По сути мы с вами создаем BI решение. Более детально мы рассмотрим про BI в модуле 3.

1. [Введение в Google Data Studio](https://analytics.google.com/analytics/academy/course/10) (English)
2. [AWS QuickSight практика](https://docs.aws.amazon.com/quicksight/latest/user/getting-started.html) (English)
3. [Klipfolio практика](https://www.klipfolio.com/blogs-and-tutorials) (English)
4. [Пиратские метрики](https://vc.ru/trade/53154-piratskie-metriki-dlya-internet-magazina) (Русский)
5. [AARRR воронка — модель «Пиратские метрики» + фреймворк AAARRR](https://leadstartup.ru/db/aarrr) (Русский)
6. [Обзор книги «Lean Analytics»](https://gopractice.ru/lean_analytics/) (Русский)

